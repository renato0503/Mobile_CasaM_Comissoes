<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CASA MASSIMA | Commissions</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* =========================================
           iOS / APPLE THEME VARIABLES
           ========================================= */
        :root {
            --ios-bg: #000000;
            --ios-card: #1c1c1e;
            --ios-card-border: #2c2c2e;
            --ios-input-bg: #2c2c2e;
            --ios-header-bg: rgba(28, 28, 30, 0.85);
            
            --brand-red: #ff453a;
            --brand-gold: #ffd60a;
            --brand-blue: #0a84ff;
            --brand-green: #30d158;
            --brand-orange: #ff9f0a;
            
            --text-primary: #ffffff;
            --text-secondary: #8e8e93;
            --text-tertiary: #48484a;

            --radius-l: 20px;
            --radius-m: 12px;
            --radius-s: 8px;
            
            --safe-area-top: env(safe-area-inset-top);
            --safe-area-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            background-color: var(--ios-bg);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            font-size: 15px;
            overflow-x: hidden;
            padding-bottom: calc(80px + var(--safe-area-bottom));
        }

        /* =========================================
           HEADER & NAVIGATION
           ========================================= */
        .app-header {
            position: fixed; top: 0; left: 0; right: 0;
            height: calc(60px + var(--safe-area-top));
            padding-top: var(--safe-area-top);
            background: var(--ios-header-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 0.5px solid var(--ios-card-border);
            display: flex; align-items: center; justify-content: space-between;
            padding-left: 16px; padding-right: 16px;
            z-index: 1000;
        }

        .header-left { display: flex; align-items: center; gap: 15px; }
        .menu-btn { background: none; border: none; color: var(--brand-gold); font-size: 22px; cursor: pointer; padding: 5px; }
        .app-title { font-weight: 700; font-size: 17px; letter-spacing: -0.5px; }
        .app-title span { display: block; font-size: 10px; color: var(--text-secondary); font-weight: 400; text-transform: uppercase; }
        .header-actions { display: flex; gap: 15px; }
        .action-btn { background: none; border: none; color: var(--brand-blue); font-size: 18px; cursor: pointer; }

        /* =========================================
           SIDEBAR (DRAWER)
           ========================================= */
        .drawer-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5); z-index: 1001;
            opacity: 0; pointer-events: none; transition: 0.3s ease;
            backdrop-filter: blur(2px);
        }
        .drawer-overlay.active { opacity: 1; pointer-events: all; }

        .drawer {
            position: fixed; top: 0; left: 0; bottom: 0;
            width: 280px; background: var(--ios-card);
            transform: translateX(-100%); transition: 0.3s cubic-bezier(0.25, 1, 0.5, 1);
            z-index: 1002; padding: 30px 20px;
            display: flex; flex-direction: column;
            border-right: 1px solid var(--ios-card-border);
        }
        .drawer.active { transform: translateX(0); }

        .brand-profile { margin-bottom: 30px; display: flex; align-items: center; gap: 15px; }
        .brand-logo { 
            width: 48px; height: 48px; border-radius: 12px; 
            background: linear-gradient(135deg, #7a1f20, #3e1213);
            display: flex; align-items: center; justify-content: center;
            color: var(--brand-gold); font-weight: 800; font-size: 20px;
            box-shadow: 0 4px 15px rgba(122, 31, 32, 0.4);
        }
        
        .nav-list { list-style: none; padding: 0; margin: 0; flex: 1; }
        .nav-item { margin-bottom: 10px; }
        .nav-link {
            display: flex; align-items: center; gap: 15px;
            padding: 14px; border-radius: 12px;
            color: var(--text-secondary); text-decoration: none;
            font-weight: 600; font-size: 15px; transition: 0.2s;
        }
        .nav-link.active { background: rgba(255, 69, 58, 0.15); color: var(--brand-red); }
        .user-info { margin-top: auto; padding-top: 20px; border-top: 1px solid var(--ios-card-border); display: flex; align-items: center; gap: 12px; }
        .avatar { width: 40px; height: 40px; border-radius: 50%; background: #333; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }

        /* =========================================
           MAIN CONTENT
           ========================================= */
        .container {
            padding: calc(75px + var(--safe-area-top)) 16px 20px 16px;
            max-width: 800px; margin: 0 auto;
        }

        /* Wallet Cards Horizontal Scroll */
        .wallet-scroller {
            display: flex; gap: 12px; overflow-x: auto;
            padding-bottom: 10px; margin-bottom: 20px;
            scrollbar-width: none;
        }
        .wallet-scroller::-webkit-scrollbar { display: none; }

        .wallet-card {
            min-width: 260px; height: 140px;
            background: linear-gradient(135deg, #1c1c1e 0%, #2c2c2e 100%);
            padding: 20px; border-radius: var(--radius-l);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            position: relative; overflow: hidden;
            border: 1px solid var(--ios-card-border);
            display: flex; flex-direction: column; justify-content: space-between;
        }
        /* Card Types */
        .card-pending { border-left: 4px solid var(--brand-orange); }
        .card-paid { border-left: 4px solid var(--brand-green); }
        .card-deduction { border-left: 4px solid var(--brand-red); }

        .w-label { font-size: 11px; text-transform: uppercase; color: var(--text-secondary); letter-spacing: 1px; }
        .w-value { font-size: 28px; font-weight: 700; color: white; letter-spacing: -0.5px; }
        .w-sub { font-size: 11px; display: flex; align-items: center; gap: 6px; color: var(--text-tertiary); }
        
        .c-icon { 
            position: absolute; right: 15px; top: 15px; 
            font-size: 24px; opacity: 0.2; color: white; 
        }

        /* Chart Section */
        .chart-section {
            background: var(--ios-card); padding: 15px; border-radius: var(--radius-l);
            margin-bottom: 24px;
        }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .section-title { font-size: 13px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; }

        /* Transaction List */
        .trans-list { list-style: none; padding: 0; margin: 0; }
        .trans-item {
            background: var(--ios-card); padding: 15px; border-radius: var(--radius-m);
            margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;
        }
        .t-left { display: flex; gap: 12px; align-items: center; }
        .t-icon {
            width: 40px; height: 40px; border-radius: 10px;
            display: flex; justify-content: center; align-items: center;
            font-size: 18px;
        }
        .icon-pending { background: rgba(255, 159, 10, 0.15); color: var(--brand-orange); }
        .icon-paid { background: rgba(48, 209, 88, 0.15); color: var(--brand-green); }
        .icon-hold { background: rgba(255, 69, 58, 0.15); color: var(--brand-red); }

        .t-info h4 { margin: 0; font-size: 14px; color: white; }
        .t-info span { font-size: 11px; color: var(--text-secondary); }
        
        .t-right { text-align: right; }
        .t-amount { font-size: 15px; font-weight: 700; color: white; display: block; }
        .t-status { font-size: 10px; font-weight: 600; text-transform: uppercase; }
        
        .st-pending { color: var(--brand-orange); }
        .st-paid { color: var(--brand-green); }
        .st-hold { color: var(--brand-red); }

        /* Floating Action Button */
        .fab {
            position: fixed; bottom: calc(20px + var(--safe-area-bottom)); right: 20px;
            width: 56px; height: 56px; background: var(--brand-blue);
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            color: white; font-size: 24px; box-shadow: 0 4px 15px rgba(10, 132, 255, 0.4);
            z-index: 900; border: none;
        }

        /* Modal Sheet */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
            z-index: 2000; display: none; align-items: flex-end; justify-content: center;
        }
        .modal-sheet {
            background: var(--ios-card); width: 100%; max-width: 600px;
            border-top-left-radius: 20px; border-top-right-radius: 20px;
            padding: 25px; padding-bottom: calc(25px + var(--safe-area-bottom));
            animation: slideUp 0.3s ease-out;
            max-height: 90vh; overflow-y: auto;
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .sheet-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .sheet-title { font-weight: 700; font-size: 18px; }

        .ios-input-group { margin-bottom: 15px; }
        .ios-label { display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 5px; text-transform: uppercase; }
        .ios-input {
            width: 100%; background: var(--ios-input-bg); border: none; border-radius: 8px;
            padding: 12px; color: white; font-size: 16px; outline: none;
        }
        .ios-btn {
            width: 100%; padding: 14px; border-radius: 12px; border: none; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 10px;
        }
        .btn-primary { background: var(--brand-blue); color: white; }
        .btn-danger { background: rgba(255, 69, 58, 0.15); color: var(--brand-red); margin-top: 10px; }

        /* Receipt Print Specific */
        @media print {
            body { background: white; color: black; }
            .drawer, .app-header, .fab, .wallet-scroller, .chart-section { display: none; }
            .receipt-print { display: block !important; padding: 20px; }
        }
        .receipt-print { display: none; }

    </style>
</head>
<body>

    <div class="drawer-overlay" id="drawerOverlay" onclick="toggleMenu()"></div>
    <aside class="drawer" id="mainDrawer">
        <div class="brand-profile">
            <div class="brand-logo">M</div>
            <div>
                <div style="font-weight:700; font-size:16px;">CASA MASSIMA</div>
                <div style="font-size:11px; color:var(--text-secondary);">Enterprise ERP</div>
            </div>
        </div>
        
        <ul class="nav-list">
            <li class="nav-item">
                <a href="https://renato0503.github.io/Mobile_CasaM_Menu/" class="nav-link">
                    <i class="fa fa-truck-fast"></i> Simulador Logístico
                </a>
            </li>
            <li class="nav-item">
                <a href="https://renato0503.github.io/Mobile_CasaM_PerformanceComercial/" class="nav-link">
                    <i class="fa fa-chart-line"></i> Performance
                </a>
            </li>
            <li class="nav-item">
                <a href="https://renato0503.github.io/Mobile_CasaM_EquipeVendas/" class="nav-link">
                    <i class="fa fa-users"></i> Equipe
                </a>
            </li>
            <li class="nav-item">
                <a href="https://renato0503.github.io/Mobile_CasaM_Comissoes/" class="nav-link active">
                    <i class="fa fa-file-invoice-dollar"></i> Comissões
                </a>
            </li>
            <li class="nav-item">
                <a href="https://renato0503.github.io/Mobile_CasaM_RotasZonas/" class="nav-link">
                    <i class="fa fa-map-location-dot"></i> Rotas & Zonas
                </a>
            </li>
        </ul>

        <div class="user-info">
            <div class="avatar">F</div>
            <div>
                <div style="font-weight:600; font-size:14px;">Fausto</div>
                <div style="font-size:11px; color:var(--text-secondary);">Diretor Comercial</div>
            </div>
        </div>
    </aside>

    <header class="app-header">
        <div class="header-left">
            <button class="menu-btn" onclick="toggleMenu()"><i class="fa fa-bars"></i></button>
            <div class="app-title">Comissões <span>Fevereiro 2026</span></div>
        </div>
        <div class="header-actions">
            <button class="action-btn" onclick="toggleRules()"><i class="fa fa-gear"></i></button>
        </div>
    </header>

    <button class="fab" onclick="openAdvanceModal()"><i class="fa fa-hand-holding-dollar"></i></button>

    <main class="container">

        <div class="wallet-scroller">
            <div class="wallet-card card-pending">
                <i class="fa fa-clock c-icon"></i>
                <span class="w-label">Saldo Pendente</span>
                <span class="w-value" id="valPending" style="color:var(--brand-orange)">R$ 0,00</span>
                <span class="w-sub">12 Vendedores aguardando</span>
            </div>
            
            <div class="wallet-card card-paid">
                <i class="fa fa-check-circle c-icon"></i>
                <span class="w-label">Pago no Mês</span>
                <span class="w-value" id="valPaid" style="color:var(--brand-green)">R$ 0,00</span>
                <span class="w-sub">Fechamento parcial</span>
            </div>
            
            <div class="wallet-card card-deduction">
                <i class="fa fa-minus-circle c-icon"></i>
                <span class="w-label">Vales / Descontos</span>
                <span class="w-value" id="valDeductions" style="color:var(--brand-red)">- R$ 0,00</span>
                <span class="w-sub">Adiantamentos vigentes</span>
            </div>
        </div>

        <div class="chart-section">
            <div class="section-header">
                <span class="section-title">Fluxo de Pagamentos</span>
            </div>
            <div style="height: 200px; width:100%">
                <canvas id="financeChart"></canvas>
            </div>
        </div>

        <div class="section-header" style="margin-top:20px; margin-bottom:10px">
            <span class="section-title">Extrato Recente</span>
            <span style="font-size:11px; color:var(--brand-blue)">Ver todos</span>
        </div>
        
        <ul class="trans-list" id="transList">
            </ul>

    </main>

    <div class="modal-overlay" id="modalAdvance" onclick="closeModal(event, 'modalAdvance')">
        <div class="modal-sheet">
            <div class="sheet-header">
                <span class="sheet-title">Lançar Vale</span>
                <button class="action-btn" onclick="document.getElementById('modalAdvance').style.display='none'"><i class="fa fa-times"></i></button>
            </div>
            <div class="ios-input-group">
                <label class="ios-label">Vendedor</label>
                <select class="ios-input" id="advAgent"></select>
            </div>
            <div class="ios-input-group">
                <label class="ios-label">Valor (R$)</label>
                <input type="number" class="ios-input" id="advValue" placeholder="0,00">
            </div>
            <div class="ios-input-group">
                <label class="ios-label">Motivo</label>
                <input type="text" class="ios-input" placeholder="Ex: Combustível, Emergência...">
            </div>
            <button class="ios-btn btn-primary" onclick="addDeduction()">Confirmar Lançamento</button>
        </div>
    </div>

    <div class="modal-overlay" id="modalRules" onclick="closeModal(event, 'modalRules')">
        <div class="modal-sheet">
            <div class="sheet-header">
                <span class="sheet-title">Regras de Comissão</span>
                <button class="action-btn" onclick="document.getElementById('modalRules').style.display='none'"><i class="fa fa-times"></i></button>
            </div>
            <p style="font-size:12px; color:#666; margin-bottom:20px">Defina a % aplicada por faixa de faturamento.</p>
            
            <div class="ios-input-group" style="display:flex; gap:10px; align-items:center">
                <div style="flex:1"><label class="ios-label">Bronze (Até 50k)</label></div>
                <input type="number" class="ios-input" value="2.0" style="width:80px; text-align:center">
                <span style="color:#666">%</span>
            </div>
            <div class="ios-input-group" style="display:flex; gap:10px; align-items:center">
                <div style="flex:1"><label class="ios-label">Prata (50k - 100k)</label></div>
                <input type="number" class="ios-input" value="2.5" style="width:80px; text-align:center">
                <span style="color:#666">%</span>
            </div>
            <div class="ios-input-group" style="display:flex; gap:10px; align-items:center">
                <div style="flex:1"><label class="ios-label">Ouro (Acima 100k)</label></div>
                <input type="number" class="ios-input" value="3.0" style="width:80px; text-align:center">
                <span style="color:#666">%</span>
            </div>
            <button class="ios-btn btn-primary" onclick="document.getElementById('modalRules').style.display='none'">Salvar Regras</button>
        </div>
    </div>

    <div id="receiptArea" class="receipt-print">
        <h2 style="text-align:center">RECIBO DE PAGAMENTO</h2>
        <p><strong>Beneficiário:</strong> <span id="recName"></span></p>
        <p><strong>Valor Líquido:</strong> <span id="recVal"></span></p>
        <p style="margin-top:50px; border-top:1px solid #000">Assinatura</p>
    </div>

    <script>
        const fmtMoney = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });
        
        // MOCK DATA
        let transactions = [
            { id: 101, ref: 'FEV/26', agent: 'Carlos Silva', sales: 154000, base: 154000, rate: 3.0, ded: 500, status: 'pending' },
            { id: 102, ref: 'FEV/26', agent: 'Ana Pereira', sales: 82000, base: 82000, rate: 2.5, ded: 0, status: 'paid' },
            { id: 103, ref: 'FEV/26', agent: 'Roberto Dias', sales: 210000, base: 210000, rate: 3.0, ded: 1200, status: 'pending' },
            { id: 104, ref: 'FEV/26', agent: 'Fernanda Lima', sales: 55000, base: 55000, rate: 2.5, ded: 200, status: 'hold' },
            { id: 105, ref: 'JAN/26', agent: 'Carlos Silva', sales: 140000, base: 140000, rate: 3.0, ded: 0, status: 'paid' }
        ];

        function toggleMenu() {
            const drawer = document.getElementById('mainDrawer');
            const overlay = document.getElementById('drawerOverlay');
            if(drawer.classList.contains('active')) {
                drawer.classList.remove('active');
                overlay.classList.remove('active');
            } else {
                drawer.classList.add('active');
                overlay.classList.add('active');
            }
        }

        window.onload = () => {
            calculateTotals();
            renderList();
            initChart();
            populateAgents();
        };

        function calculateTotals() {
            let pending = 0, paid = 0, ded = 0;
            transactions.forEach(t => {
                const net = (t.base * (t.rate/100)) - t.ded;
                ded += t.ded;
                if(t.status === 'pending' || t.status === 'hold') pending += net;
                if(t.status === 'paid' && t.ref === 'FEV/26') paid += net;
            });

            document.getElementById('valPending').innerText = fmtMoney.format(pending);
            document.getElementById('valPaid').innerText = fmtMoney.format(paid);
            document.getElementById('valDeductions').innerText = "- " + fmtMoney.format(ded);
        }

        function renderList() {
            const list = document.getElementById('transList');
            list.innerHTML = '';

            transactions.forEach(t => {
                const net = (t.base * (t.rate/100)) - t.ded;
                
                let iconClass = 'icon-pending'; 
                let icon = 'fa-clock';
                let statusText = 'Pendente';
                let stClass = 'st-pending';
                let action = `onclick="payItem(${t.id})"`;

                if(t.status === 'paid') {
                    iconClass = 'icon-paid'; icon = 'fa-check'; statusText = 'Pago'; stClass = 'st-paid';
                    action = `onclick="printReceipt('${t.agent}', ${net})"`;
                } else if(t.status === 'hold') {
                    iconClass = 'icon-hold'; icon = 'fa-hand'; statusText = 'Retido'; stClass = 'st-hold';
                    action = `onclick="alert('Item retido por pendência cadastral')"`;
                }

                const html = `
                    <li class="trans-item" ${action}>
                        <div class="t-left">
                            <div class="t-icon ${iconClass}"><i class="fa ${icon}"></i></div>
                            <div class="t-info">
                                <h4>${t.agent}</h4>
                                <span>Ref: ${t.ref} • ${t.rate}%</span>
                            </div>
                        </div>
                        <div class="t-right">
                            <span class="t-amount">${fmtMoney.format(net)}</span>
                            <span class="t-status ${stClass}">${statusText}</span>
                        </div>
                    </li>
                `;
                list.innerHTML += html;
            });
        }

        // ACTIONS
        function payItem(id) {
            const tx = transactions.find(t => t.id === id);
            if(confirm(`Confirmar pagamento para ${tx.agent}?`)) {
                tx.status = 'paid';
                renderList();
                calculateTotals();
            }
        }

        function printReceipt(name, val) {
            document.getElementById('recName').innerText = name;
            document.getElementById('recVal').innerText = fmtMoney.format(val);
            window.print();
        }

        // MODALS
        function openAdvanceModal() { document.getElementById('modalAdvance').style.display = 'flex'; }
        function toggleRules() { document.getElementById('modalRules').style.display = 'flex'; }
        
        function closeModal(e, id) {
            if(e.target.id === id) document.getElementById(id).style.display = 'none';
        }

        function populateAgents() {
            const uniqueAgents = [...new Set(transactions.map(t => t.agent))];
            const sel = document.getElementById('advAgent');
            uniqueAgents.forEach(a => {
                const opt = document.createElement('option');
                opt.value = a;
                opt.innerText = a;
                sel.appendChild(opt);
            });
        }

        function addDeduction() {
            alert('Vale lançado com sucesso!');
            document.getElementById('modalAdvance').style.display = 'none';
        }

        // CHART
        function initChart() {
            const ctx = document.getElementById('financeChart').getContext('2d');
            Chart.defaults.font.family = "-apple-system, sans-serif";
            Chart.defaults.color = "#8e8e93";
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Set', 'Out', 'Nov', 'Dez', 'Jan', 'Fev'],
                    datasets: [
                        { label: 'Pago', data: [12, 15, 14, 18, 16, 4], backgroundColor: '#30d158', borderRadius: 4 },
                        { label: 'Pendente', data: [0, 0, 0.5, 0, 0, 12], backgroundColor: '#ff9f0a', borderRadius: 4 }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { display: false } },
                        y: { display: false }
                    }
                }
            });
        }
    </script>
</body>
</html>